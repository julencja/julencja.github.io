<!doctype html>
<html>
<head>	
	<meta charset="utf-8" />
	<title>Size calculator</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
	<script type="text/javascript">
	// braSizes holds 
	var braSizes = [
					{
						bandEU: 55,
						bandUS: 22,
						cupStart: 5,
						cups: 	['DD', 'DDD', 'G', 'H', 'HH', 'J', 'K', 'L', 'M', 'N', 'O']
					},
					{
						bandEU: 60,
						bandUS: 24,
						cupStart: 1,
						cups: 	['D', 'DD', 'DDD', 'G', 'H', 'HH', 'J', 'K', 'L', 'M', 'N', 'O']
					},
					{
						bandEU: 65,
						bandUS: 26,
						cupStart: 1,
						cups: 	['C', 'D', 'DD', 'DDD', 'G', 'H', 'HH', 'J', 'K', 'L', 'M', 'N', 'O']
					},
					{
						bandEU: 70,
						bandUS: 28,
						cupStart: 1,
						cups: 	['B', 'C', 'D', 'DD', 'DDD', 'G', 'H', 'HH', 'J', 'K', 'L', 'M', 'N']
					},
					{
						bandEU: 75,
						bandUS: 30,
						cupStart: 2,
						cups: 	['B', 'C', 'D', 'DD', 'DDD', 'G', 'H', 'HH', 'J', 'K', 'L', 'M']
					},
					{
						bandEU: 80,						
						bandUS: 32,
						cupStart: 3,
						cups: 	['B', 'C', 'D', 'DD', 'DDD', 'G', 'H', 'HH', 'J', 'K', 'L']
					},
					{
						bandEU: 85,
						bandUS: 34,
						cupStart: 4,
						cups: 	['B', 'C', 'D', 'DD', 'DDD', 'G', 'H', 'HH', 'J', 'K']
					},
					{
						bandEU: 90,
						bandUS: 36,
						cupStart: 5,
						cups: 	['B', 'C', 'D', 'DD', 'DDD', 'G', 'H', 'HH', 'J']
					},
					{
						bandEU: 95,
						bandUS: 38,
						cupStart: 6,
						cups: 	['B', 'C', 'D', 'DD', 'DDD', 'G', 'H', 'HH']
					},
					{
						bandEU: 100,
						bandUS: 40,
						cupStart: 7,
						cups: 	['B', 'C', 'D', 'DD', 'DDD', 'G', 'H']
					},
					{
						bandEU: 105,
						bandUS: 42,
						cupStart: 8,
						cups: 	['B', 'C', 'D', 'DD', 'DDD', 'G']
					},
					{
						bandEU: 110,
						bandUS: 44,
						cupStart: 9,
						cups: 	['B', 'C', 'D', 'DD', 'DDD']
					},
					{
						bandEU: 115,
						bandUS: 46,
						cupStop: 5,
						cups: 	['B', 'C', 'D', 'DD']
					},
				];

	var cups = ['A', 'B', 'C', 'D', 'DD', 'DDD', 'G', 'H', 'HH', 'J', 'K', 'L', 'M', 'N', 'O'];

	//assert underbust, overbust type of number; unit in ["cm","in"]
	function calculateCup(underbust, overbust, unit){
			if (unit === "in") {
				var difference = Math.round(overbust - underbust);
				if (difference < 1) {return "noCup"} else{return cups[difference-1]};
			};
			if (unit === "cm") {
				var difference = overbust - underbust;
				if (difference < 2.54) {return "noCup"} else{
					// 1 in = 2.54 cm
					var cupIndex =  Math.round(difference/2.54)
					return cups[cupIndex-1];
			};
		};		
	};

	//assert underbust type of number, unit in ["cm","in"]
	function calculateBand(underbust, unit){
		if (unit === "in") {
			//round the underbust down
			underbust = Math.ceil(underbust);
			if (underbust % 2 === 0) {return underbust} else {
				//round down odd underbust measurement to the nearest band
				return (underbust+1);
			};			
		};
		if (unit === "cm") {
			//round the underbust to integer
			underbust = Math.round(underbust);
			if (underbust%5 < 3) 
				//round to the nearest multiple of 5
				{var bandEU = (underbust - underbust%5)}
			else
				{var bandEU = (underbust - underbust%5 + 5)};
			//convert EU band to US band
			return (Math.ceil(bandEU/2.54))
		};
	};

	//check if we have this size, 
	//assert typeOf(bandSize) == integer, typeOf(cupSize) == string
	//make sure there are now identical bandUS and bandEU in the braSizes object
	function sizeAvailable(bandSize,cupSize){
		for (var i = 0; i < braSizes.length; i++) {
				var band = braSizes[i];
				if (bandSize === band.bandUS || bandSize === band.bandEU) {
					for (var j = 0; j < band.cups.length; j++) {
						var cup = band.cups[j];
						if (cup === cupSize) {return true}
					};
				}; 				
		};
		return false;
	};

	//calculate size from measurements
	//unit in ["cm","in"]
	function calculateSize(underbust, overbust, unit){
		var bandSize = calculateBand(underbust,unit);
		var cupSize =  calculateCup(underbust, overbust, unit);
		//check if the size belongs to the universum of braSizes
		if (sizeAvailable(bandSize, cupSize)) {return [bandSize,cupSize]} else{return "noSize"};
	};

	//find a sister size which feels loser
	//assert typeOf(braSize) == array
	function sisterLoose (braSize) {
		var sisterBand = braSize[0]+2;
		var cupSize = braSize[1];
		var cupIndex = cups.indexOf(cupSize)-1;
		var sisterCup = cups[cupIndex];
		//check if the size in braSizes
		if (sizeAvailable(sisterBand,sisterCup)) {return([sisterBand,sisterCup])} else{return "noSister"};
	};

	//find a sister size which feels more snug
	//assert typeOf(braSize) == array
	function sisterSnug (braSize){
		var sisterBand = braSize[0]-2;
		var cupSize = braSize[1];
		var cupIndex = cups.indexOf(cupSize)+1;
		var sisterCup = cups[cupIndex];
		//check if the size in braSizes
		if (sizeAvailable(sisterBand,sisterCup)) {return([sisterBand,sisterCup])} else{return "noSister"};
	};

	//determine unit
	function whatUnit(){
		if ($('#metric').is(':checked')) {return "cm"} else { return "in"};
	};

	//Switch UI between units cm<>in
	function switchUI(fromUnit,toUnit){
		//switch from inches to centimeters
		if (fromUnit === "in") {
			var newUnder = Math.round($('#underbust').val()*2.54);
			var newOver = Math.round($('#overbust').val()*2.54);
			var newUnderMin = Math.round($('#underbustSlider').slider('option','min')*2.54);
			var newOverMin = Math.round($('#overbustSlider').slider('option','min')*2.54);
			var newUnderMax = Math.round($('#underbustSlider').slider('option','max')*2.54);
			var newOverMax = Math.round($('#overbustSlider').slider('option','max')*2.54);
			//convert input values to cm
			$('#underbust').val(newUnder);
			$('#overbust').val(newOver);
			//convert slider min
			$('#underbustSlider').slider('option', 'min',newUnderMin);
			$('#overbustSlider').slider('option', 'min',newOverMin);
			//convert sider max
			$('#underbustSlider').slider('option', 'max',newUnderMax);
			$('#overbustSlider').slider('option', 'max',newOverMax);
			//convert slider value
			$('#underbustSlider').slider('value',newUnder);
			$('#overbustSlider').slider('value',newOver);
			//set slider labels
			$("#underbustSliderMin").text($('#underbustSlider').slider("option","min"));	
			$("#underbustSliderMax").text($('#underbustSlider').slider("option","max"));	
			$("#overbustSliderMin").text($('#overbustSlider').slider("option","min"));	
			$("#overbustSliderMax").text($('#overbustSlider').slider("option","max"));	
		};
		if (fromUnit === "cm") {
			var newUnder = Math.round($('#underbust').val()/2.54);
			var newOver = Math.round($('#overbust').val()/2.54);
			var newUnderMin = Math.round($('#underbustSlider').slider('option','min')/2.54);
			var newOverMin = Math.round($('#overbustSlider').slider('option','min')/2.54);
			var newUnderMax = Math.round($('#underbustSlider').slider('option','max')/2.54);
			var newOverMax = Math.round($('#overbustSlider').slider('option','max')/2.54);
			//convert input values to cm
			$('#underbust').val(newUnder);
			$('#overbust').val(newOver);
			//convert slider min
			$('#underbustSlider').slider('option', 'min',newUnderMin);
			$('#overbustSlider').slider('option', 'min',newOverMin);
			//convert sider max
			$('#underbustSlider').slider('option', 'max',newUnderMax);
			$('#overbustSlider').slider('option', 'max',newOverMax);
			//convert slider value
			$('#underbustSlider').slider('value',newUnder);
			$('#overbustSlider').slider('value',newOver);
			//set slider labels
			$("#underbustSliderMin").text($('#underbustSlider').slider("option","min"));	
			$("#underbustSliderMax").text($('#underbustSlider').slider("option","max"));	
			$("#overbustSliderMin").text($('#overbustSlider').slider("option","min"));	
			$("#overbustSliderMax").text($('#overbustSlider').slider("option","max"));	
		};
	};

	$( document ).ready(function() {
	//Calculate size from input    	 		
    	$('#calculateSize').click(function(){
    		//pass unit from checkbox
    		var under = parseInt($('#underbust').val()); 
    		var over = parseInt($('#overbust').val());
    		var unit = whatUnit();
    		var yourSize = calculateSize(under,over,unit);
    		var snugSisterSize = sisterSnug(yourSize);
    		var looseSisterSize = sisterLoose(yourSize);
    		//Display Snug and Comfy recommendations
    		$("#comfy").text(yourSize[0]+yourSize[1]);
    		$("#snug").text(snugSisterSize[0]+snugSisterSize[1]);
    		//Add results to test Table
    		var row = $('<tr></tr>');
    		row.append("<td>"+unit+"</td><td>"+under+"</td><td>"+over+"</td><td>"+yourSize[0]+yourSize[1]+"</td><td>"+snugSisterSize[0]+snugSisterSize[1]+"</td><td>"+looseSisterSize[0]+looseSisterSize[1]+"</td>");
    		$('#testResults').prepend(row);
    	}); 		

	//Initialize sliders
		//underbust
	    var underWidget = $( "#underbustSlider" ).slider({
	    	orientation: "horizontal",
	      	value: $("#underbust").val(),
	      	step: .5,
	      	//Deafult min and max in inches
	      	min: braSizes[0].bandUS-1,
	      	max: braSizes[braSizes.length-1].bandUS+.5,
	      	slide: function(event,ui){
	      		$("#underbust").val(ui.value);
  			}
    	});
		//overbust
		var overWidget = $( "#overbustSlider" ).slider({
			orientation: "horizontal",
	      	value: $("#overbust").val(),
	      	step: .5,
	      	//Deafult min and max in inches
	      	min: braSizes[0].bandUS + braSizes[0].cupStart,
	      	max: braSizes[braSizes.length-1].bandUS + braSizes[braSizes.length-1].cupStop,
	      	slide: function(event,ui){
	      		$("#overbust").val(ui.value);
	      	},
    	});
		//Set min and max slider labels
		$("#underbustSliderMin").text(underWidget.slider("option","min"));	
		$("#underbustSliderMax").text(underWidget.slider("option","max"));	
		$("#overbustSliderMin").text(overWidget.slider("option","min"));	
		$("#overbustSliderMax").text(overWidget.slider("option","max"));	
	
	//Set slider values with input fields
		$('#underbust').change(function(){
			var current = $(this).val();
			underWidget.slider('value',current);
		});		
		$('#overbust').change(function(){
			var current = $(this).val();
			overWidget.slider('value',current);
		});
	

		//Switch radio buttons name="units" when labels clicked
		$("label[for='in']").click(function(){
			//remove checked from "cm"
			$("input[value='cm']").prop('checked', false);
			//check "in"
			$("input[value='in'").prop('checked',true);
			//switch UI
			switchUI("cm","in");
		});
		$("label[for='cm']").click(function(){
			//remove checked from "in"
			$("input[value='in']").prop('checked', false);
			//check "in"
			$("input[value='cm'").prop('checked',true);
			//switch UI
			switchUI("in","cm");
		});

	//>>> End of document.ready()	
	});

	</script>
	<link type="text/css" rel="stylesheet" href="style.css">
  	<link href='http://fonts.googleapis.com/css?family=Lato:300, 400,700|Playfair+Display:400,900,400italic,900italic' rel='stylesheet' type='text/css'>
</head>
<body>
	<header>
		<div class="wrapper">
			<img src="logo.png">
			<h1>Bra Size Calculator</h1>
		</div>
	</header>
	<div class="wrapper">
		<div id="units">
			<input type="radio" name="units" value="in" checked><label for="in">in</label>
			<input type="radio" name="units" value="cm" id="metric"><label for="cm">cm</label>
		</div>
		
		<div class="measure span_6_of_12 col">
			<h2>your underbust</h2>
			<p>Measure your chest just under your breasts. Remeber the tape must lie flat on your chest horizontally to the ground.</p>
			<input type="number" step="1" value="31" id="underbust"/><br>
			<span id="underbustSliderMin">min</span><div id="underbustSlider" class="slider"></div><span id="underbustSliderMax">max</span>
		</div>
		<div class="measure span_6_of_12 col">
			<h2>your overbust</h2>
			<p>Now wrap the tape around the fullest part of your chest and measure your overbust.</p> 
			<input type="number" step="1" value="41" id="overbust" /><br>
			<span id="overbustSliderMin">min</span><div id="overbustSlider" class="slider"></div><span id="overbustSliderMax">min</span>
		</div>	

		<div id="button">
			<button id="calculateSize">check your size</button>
		</div>
	<div id="result">
		<h2>we recommend sizes:<br> 
			comfy: <span id="comfy" class="sizeSugestion">?</span> | snug: <span id="snug" class="sizeSugestion">?</span><h2>
	</div>
	<small>Test results table</small>
	<table id="testResults">
		<thead>
			<td>Unit</td>
			<td>Underbust</td>
			<td>Overbust</td>
			<td>Comfy size</td>
			<td>Snug sister</td>
			<td>Loose sister</td>
		</thead>
		<tbody>
		</tbody>
	</table>
</div>
</body>
</html>